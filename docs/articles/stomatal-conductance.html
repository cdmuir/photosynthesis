<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting stomatal conductance models â€¢ photosynthesis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting stomatal conductance models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">photosynthesis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/co2-response.html">Fitting CO2 response curves</a></li>
    <li><a class="dropdown-item" href="../articles/hydraulic-vulnerability.html">Fitting hydraulic vulnerability curves</a></li>
    <li><a class="dropdown-item" href="../articles/light-respiration.html">Fit models to estimate light respiration</a></li>
    <li><a class="dropdown-item" href="../articles/light-response.html">Fitting light response curves</a></li>
    <li><a class="dropdown-item" href="../articles/mesophyll-conductance.html">Fitting mesophyll conductance</a></li>
    <li><a class="dropdown-item" href="../articles/modeling-recommendations.html">Modeling C3 Photosynthesis: recommendations for common scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/photosynthesis-introduction.html">Introduction to the photosynthesis package</a></li>
    <li><a class="dropdown-item" href="../articles/pressure-volume.html">Fitting pressure-volume curves</a></li>
    <li><a class="dropdown-item" href="../articles/sensitivity-analysis.html">Sensitivity analysis</a></li>
    <li><a class="dropdown-item" href="../articles/stomatal-conductance.html">Fitting stomatal conductance models</a></li>
    <li><a class="dropdown-item" href="../articles/temperature-response.html">Fitting temperature response curves</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/cdmuir/photosynthesis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting stomatal conductance models</h1>
                        <h4 data-toc-skip class="author">Joseph R.
Stinziano and Christopher D. Muir</h4>
            
            <h4 data-toc-skip class="date">2024-11-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cdmuir/photosynthesis/blob/HEAD/vignettes/stomatal-conductance.Rmd"><code>vignettes/stomatal-conductance.Rmd</code></a></small>
      <div class="d-none name"><code>stomatal-conductance.Rmd</code></div>
    </div>

    
    
<p>The package currently supports three varieties of stomatal
conductance models (Ball <em>et al.</em> 1987; Leuning 1995; Medlyn
<em>et al.</em> 2011).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cdmuir/photosynthesis">photosynthesis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">round_to_nearest</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">values</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">values</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">values</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span>, values <span class="op">=</span> <span class="va">values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Read in data</span></span>
<span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"A_Ci_Q_data_1.csv"</span>, package <span class="op">=</span> <span class="st">"photosynthesis"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Convert RH to a proportion</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    RH <span class="op">=</span> <span class="va">RHcham</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span>    PPFD <span class="op">=</span> <span class="fu">round_to_nearest</span><span class="op">(</span><span class="va">Qin</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">125</span>, <span class="fl">375</span>, <span class="fl">750</span>, <span class="fl">1500</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>A_net <span class="op">=</span> <span class="va">A</span>, C_air <span class="op">=</span> <span class="va">Ca</span>, g_sw <span class="op">=</span> <span class="va">gsw</span>, VPD <span class="op">=</span> <span class="va">VPDleaf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the Ball-Berry stomatal conductance models</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_gs_model.html">fit_gs_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">PPFD</span> <span class="op">==</span> <span class="fl">750</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BallBerry"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at BallBerry model summary:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">[[</span><span class="st">"BallBerry"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Model"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = g_sw ~ gs_mod_ballberry(A_net = A_net, C_air = C_air, </span></span>
<span><span class="co">##     RH = RH), data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -0.05185 -0.03045  0.01009  0.02768  0.04035 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                                                          Estimate Std. Error</span></span>
<span><span class="co">## (Intercept)                                             3.659e-01  1.303e-02</span></span>
<span><span class="co">## gs_mod_ballberry(A_net = A_net, C_air = C_air, RH = RH) 3.148e-06  1.423e-06</span></span>
<span><span class="co">##                                                         t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)                                              28.076 7.63e-11 ***</span></span>
<span><span class="co">## gs_mod_ballberry(A_net = A_net, C_air = C_air, RH = RH)   2.213   0.0513 .  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.03363 on 10 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.3287, Adjusted R-squared:  0.2615 </span></span>
<span><span class="co">## F-statistic: 4.896 on 1 and 10 DF,  p-value: 0.05133</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at BallBerry parameters</span></span>
<span><span class="va">fit</span><span class="op">[[</span><span class="st">"BallBerry"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Parameters"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##          g0           g1</span></span>
<span><span class="co">## 1 0.3659298 3.148369e-06</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at BallBerry plot</span></span>
<span><span class="co"># fit[["BallBerry"]][["Graph"]]</span></span>
<span></span>
<span><span class="co"># Fit many g_sw models</span></span>
<span><span class="va">fits</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_many.html">fit_many</a></span><span class="op">(</span><span class="va">dat</span>, funct <span class="op">=</span> <span class="va">fit_gs_model</span>, group <span class="op">=</span> <span class="st">"PPFD"</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `fit_many()` was deprecated in photosynthesis 2.1.3.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<pre><code><span><span class="co">## Error in nlsModel(formula, mf, start, wts) : </span></span>
<span><span class="co">##   singular gradient matrix at initial parameter estimates</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at the Medlyn_partial outputs at 750 PAR</span></span>
<span><span class="co"># Model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fits</span><span class="op">[[</span><span class="st">"750"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Medlyn_partial"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Model"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Formula: g_sw ~ gs_mod_opti(A_net = A_net, C_air = C_air, VPD = VPD, g0, </span></span>
<span><span class="co">##     g1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameters:</span></span>
<span><span class="co">##    Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## g0  0.38778    0.03317  11.692 3.73e-07 ***</span></span>
<span><span class="co">## g1 -1.09754    0.83022  -1.322    0.216    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.04375 on 10 degrees of freedom</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of iterations to convergence: 2 </span></span>
<span><span class="co">## Achieved convergence tolerance: 1.49e-08</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model parameters</span></span>
<span><span class="va">fits</span><span class="op">[[</span><span class="st">"750"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Medlyn_partial"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Parameters"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##          g0        g1</span></span>
<span><span class="co">## 1 0.3877773 -1.097544</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Graph</span></span>
<span><span class="co"># fits[["750"]][["Medlyn_partial"]][["Graph"]]</span></span>
<span></span>
<span><span class="co"># Compile parameter outputs for BallBerry model</span></span>
<span><span class="co"># Note that it's the first element for each PAR value</span></span>
<span><span class="co"># First compile list of BallBerry fits</span></span>
<span><span class="va">bbmods</span> <span class="op">=</span> <span class="fu"><a href="../reference/compile_data.html">compile_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fits</span>, output_type <span class="op">=</span> <span class="st">"list"</span>, list_element <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now compile the parameters (2nd element) into a dataframe</span></span>
<span><span class="va">bbpars</span> <span class="op">=</span> <span class="fu"><a href="../reference/compile_data.html">compile_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bbmods</span>, output_type <span class="op">=</span> <span class="st">"dataframe"</span>, list_element <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Compile graphs</span></span>
<span><span class="va">graphs</span> <span class="op">=</span> <span class="fu"><a href="../reference/compile_data.html">compile_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bbmods</span>, output_type <span class="op">=</span> <span class="st">"list"</span>, list_element <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at 3rd graph</span></span>
<span><span class="co"># graphs[[3]]</span></span></code></pre></div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Ball JT, Woodrow IE, Berry JA. 1987. A model predicting stomatal
conductance and its contribution to the control of photosynthesis under
different environmental conditions, in <em>Progress in Photosynthesis
Research</em>, Proceedings of the VII International Congress on
Photosynthesis, vol.Â 4, edited by I. Biggins, pp.Â 221â€“224, Martinus
Nijhoff, Dordrecht, Netherlands.</p>
<p>Leuning R. 1995. A critical appraisal of a coupled
stomatal-photosynthesis model for C3 plants. <em>Plant, Cell &amp;
Environment</em> 18:339-357.</p>
<p>Medlyn BE, Duursma RA, Eamus D, Ellsworth DS, Prentice IC, Barton
CVM, Crous KY, Angelis PD, Freeman M, Wingate L. 2011. Reconciling the
optimal and empirical approaches to modeling stomatal conductance.
<em>Global Change Biology</em> 17:2134-2144.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joseph Stinziano, Cassaundra Roback, Demi Sargent, Bridget Murphy, Patrick Hudson, Chris Muir.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
